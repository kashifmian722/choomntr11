(this.webpackJsonp=this.webpackJsonp||[]).push([["frosh-platform-mail-archive"],{"0mO1":function(e,t){e.exports='<sw-page>\n    <template slot="smart-bar-header">\n        <h2>{{ $tc(\'frosh-mail-archive.title\') }}</h2>\n    </template>\n    <template slot="content">\n        <sw-entity-listing\n            v-if="items"\n            :items="items"\n            :columns="columns"\n            :isLoading="isLoading"\n            :repository="mailArchiveRepository"\n        >\n            <template slot="column-receiver" slot-scope="{ item }">\n                <span v-for="(element, index) in item.receiver">\n                    {{ element }} &lt;<a :href=\'`mailto:${index}`\'>{{ index }}</a>&gt;\n                </span>\n            </template>\n\n            <template slot="column-createdAt" slot-scope="{ item }">\n                {{ item.createdAt | date({hour: \'2-digit\', minute: \'2-digit\', second: \'2-digit\'}) }}\n            </template>\n\n            <template slot="detail-action" slot-scope="{ item }">\n                <sw-context-menu-item class="sw-entity-listing__context-menu-show-action" :routerLink="{ name: \'frosh.mail.archive.detail\', params: { id: item.id } }">\n                    {{ $tc(\'frosh-mail-archive.list.columns.action\') }}\n                </sw-context-menu-item>\n            </template>\n        </sw-entity-listing>\n    </template>\n\n    <sw-sidebar slot="sidebar">\n        <sw-sidebar-item\n            icon="default-arrow-360-left"\n            :title="$tc(\'frosh-mail-archive.list.sidebar.refresh\')"\n            @click="onRefresh">\n        </sw-sidebar-item>\n\n        <sw-sidebar-item icon="default-action-filter"\n                         :title="$tc(\'frosh-mail-archive.list.sidebar.filter\')">\n            <sw-text-field :label="$tc(\'frosh-mail-archive.list.sidebar.filters.search\')" v-model="filter.term"></sw-text-field>\n\n            <sw-entity-single-select\n                v-model="filter.salesChannelId"\n                :label="$tc(\'frosh-mail-archive.list.sidebar.filters.salesChannel\')"\n                entity="sales_channel"\n            ></sw-entity-single-select>\n\n            <sw-entity-single-select\n                v-model="filter.customerId"\n                :label="$tc(\'frosh-mail-archive.list.sidebar.filters.customer\')"\n                entity="customer"\n            >\n                <template #result-label-property="{ item, index, searchTerm, getKey }">\n                    <sw-highlight-text :text="`${getKey(item, \'firstName\')} ${getKey(item, \'lastName\')}${getKey(item, \'lastName\') ? \' (\' + getKey(item, \'lastName\') + \')\' : \'\'}`"\n                                       :searchTerm="searchTerm">\n                    </sw-highlight-text>\n                </template>\n            </sw-entity-single-select>\n\n            <sw-button\n                variant="ghost"\n                @click="resetFilter">\n                {{ $tc(\'frosh-mail-archive.list.sidebar.filters.resetFilter\') }}\n            </sw-button>\n        </sw-sidebar-item>\n    </sw-sidebar>\n</sw-page>\n'},C8g9:function(e,t,i){var a=i("zIiR");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("SZ7m").default)("67a06983",a,!0,{})},DpAk:function(e,t){e.exports='<sw-page class="frosh-mail-archive-detail">\n    <template slot="smart-bar-header">\n        <h2 v-if="archive">{{ archive.subject }}</h2>\n    </template>\n\n    <template slot="smart-bar-actions">\n        <sw-button variant="ghost" v-if="archive && archive.customer" @click="openCustomer">\n            {{ $tc(\'frosh-mail-archive.detail.toolbar.customer\') }}\n        </sw-button>\n\n        <sw-button-process :isLoading="isLoading" :processSuccess="isSuccessful" @click="resendMail">\n            {{ $tc(\'frosh-mail-archive.detail.toolbar.resend\') }}\n        </sw-button-process>\n    </template>\n\n    <template slot="content">\n        <sw-card-view v-if="archive">\n            <sw-card :title="$tc(\'frosh-mail-archive.detail.metadata.title\')">\n                <sw-text-field :label="$tc(\'frosh-mail-archive.detail.metadata.sentDate\')" :disabled="true" v-model="createdAtDate"></sw-text-field>\n                <sw-text-field :label="$tc(\'frosh-mail-archive.detail.metadata.sender\')" :disabled="true" v-model="senderText"></sw-text-field>\n                <sw-text-field :label="$tc(\'frosh-mail-archive.detail.metadata.receiver\')" :disabled="true" v-model="receiverText"></sw-text-field>\n                <sw-text-field :label="$tc(\'frosh-mail-archive.detail.metadata.subject\')" :disabled="true" v-model="archive.subject"></sw-text-field>\n                <sw-text-field :label="$tc(\'frosh-mail-archive.detail.metadata.salesChannel\')" v-if="archive.salesChannel" :disabled="true" v-model="archive.salesChannel.name"></sw-text-field>\n            </sw-card>\n            <sw-card :title="$tc(\'frosh-mail-archive.detail.content.title\')">\n                <h4>HTML</h4>\n                <iframe :src="htmlText" sandbox frameborder="0"></iframe>\n                <h4>Plain</h4>\n\n                <iframe :src="plainText" sandbox frameborder="0"></iframe>\n            </sw-card>\n        </sw-card-view>\n    </template>\n</sw-page>\n'},M8KQ:function(e,t,i){var a=i("XtRQ");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,i("SZ7m").default)("5aab3ae8",a,!0,{})},XtRQ:function(e,t,i){},"h/1B":function(e,t,i){"use strict";i.r(t);const a=Shopware.Classes.ApiService;var s=class extends a{constructor(e,t,i="frosh-mail-archive"){super(e,t,i)}resendMail(e){const t=this.getBasicHeaders({});return this.httpClient.post(`_action/${this.getApiBasePath()}/resend-mail`,{mailId:e},{...this.basicConfig,headers:t}).then(e=>a.handleResponse(e))}};const{Application:r}=Shopware;r.addServiceProvider("froshMailArchiveService",e=>{const t=r.getContainer("init");return new s(t.httpClient,e.loginService)});var n=i("0mO1"),l=i.n(n);i("C8g9");const{Component:o,Mixin:c}=Shopware,{Criteria:h}=Shopware.Data,m=Shopware.Utils;o.register("frosh-mail-archive-index",{template:l.a,inject:["repositoryFactory"],mixins:[c.getByName("listing")],metaInfo(){return{title:this.$createTitle()}},data:()=>({page:1,limit:25,total:0,repository:null,items:null,isLoading:!0,filter:{salesChannelId:null,customerId:null,term:null}}),computed:{columns:()=>[{property:"createdAt",dataIndex:"createdAt",label:"frosh-mail-archive.list.columns.sentDate",primary:!0,routerLink:"frosh.mail.archive.detail"},{property:"subject",dataIndex:"subject",label:"frosh-mail-archive.list.columns.subject",allowResize:!0,routerLink:"frosh.mail.archive.detail"},{property:"receiver",dataIndex:"receiver",label:"frosh-mail-archive.list.columns.receiver",allowResize:!0}],mailArchiveRepository(){return this.repositoryFactory.create("frosh_mail_archive")}},methods:{getList(){this.isLoading=!0;let e=new h;return this.filter.salesChannelId&&e.addFilter(h.equals("salesChannelId",this.filter.salesChannelId)),this.filter.customerId&&e.addFilter(h.equals("customerId",this.filter.customerId)),this.filter.term&&e.setTerm(this.filter.term),e.addSorting(h.sort("createdAt","DESC")),this.mailArchiveRepository.search(e,Shopware.Context.api).then(e=>{this.items=e,this.total=e.total,this.isLoading=!1})},resetFilter(){this.filter={salesChannelId:null,customerId:null,term:null},this.getList()}},watch:{filter:{deep:!0,handler:m.debounce((function(){this.getList()}),400)}}});var d=i("DpAk"),u=i.n(d);i("M8KQ");const{Component:p}=Shopware;p.register("frosh-mail-archive-detail",{template:u.a,inject:["repositoryFactory","froshMailArchiveService"],data:()=>({archive:null,isLoading:!1,isSuccessful:!1}),created(){this.repository=this.repositoryFactory.create("frosh_mail_archive"),this.repository.get(this.$route.params.id,Shopware.Context.api).then(e=>{this.archive=e})},computed:{createdAtDate(){const e=Shopware.State.getters.adminLocaleLanguage||"en";return new Intl.DateTimeFormat(e,{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date(this.archive.createdAt))},receiverText(){let e=[];return Object.keys(this.archive.receiver).forEach(t=>{e.push(`${this.archive.receiver[t]} <${t}>`)}),e.join(",")},senderText(){let e=[];return Object.keys(this.archive.sender).forEach(t=>{e.push(`${this.archive.sender[t]} <${t}>`)}),e.join(",")},htmlText(){return this.getContent(this.archive.htmlText)},plainText(){return this.getContent(this.archive.plainText)}},methods:{getContent:e=>"data:text/html;base64,"+btoa(unescape(encodeURIComponent(e.replace(/[\u00A0-\u2666]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))))),openCustomer(){this.$router.push({name:"sw.customer.detail",params:{id:this.archive.customer.id}})},resendMail(){this.isLoading=!0,this.froshMailArchiveService.resendMail(this.archive.id).then(()=>{this.isLoading=!1,this.isSuccessful=!0}).catch(()=>{this.isLoading=!1,this.isSuccessful=!1})}}}),Shopware.Module.register("frosh-mail-archive",{type:"plugin",name:"frosh-mail-archive.title",title:"frosh-mail-archive.title",description:"",color:"#62ff80",icon:"default-communication-envelope",routes:{list:{component:"frosh-mail-archive-index",path:"list"},detail:{component:"frosh-mail-archive-detail",path:"detail/:id",meta:{parentPath:"frosh.mail.archive.list"}}},settingsItem:[{group:"plugins",to:"frosh.mail.archive.list",icon:"default-communication-envelope",name:"frosh-mail-archive.title"}]})},zIiR:function(e,t,i){}},[["h/1B","runtime","vendors-node"]]]);